!(function (e, t) {
  "object" == typeof exports && "undefined" != typeof module
    ? (module.exports = t())
    : "function" == typeof define && define.amd
    ? define(t)
    : (e.autoComplete = t());
})(this, function () {
  "use strict";
  function e(e, t) {
    for (var n = 0; n < t.length; n++) {
      var i = t[n];
      (i.enumerable = i.enumerable || !1),
        (i.configurable = !0),
        "value" in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i);
    }
  }
  function t(e, t) {
    (null == t || t > e.length) && (t = e.length);
    for (var n = 0, i = new Array(t); n < t; n++) i[n] = e[n];
    return i;
  }
  function n(e) {
    if ("undefined" == typeof Symbol || null == e[Symbol.iterator]) {
      if (
        Array.isArray(e) ||
        (e = (function (e, n) {
          if (e) {
            if ("string" == typeof e) return t(e, n);
            var i = Object.prototype.toString.call(e).slice(8, -1);
            return (
              "Object" === i && e.constructor && (i = e.constructor.name),
              "Map" === i || "Set" === i
                ? Array.from(i)
                : "Arguments" === i ||
                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)
                ? t(e, n)
                : void 0
            );
          }
        })(e))
      ) {
        var n = 0,
          i = function () {};
        return {
          s: i,
          n: function () {
            return n >= e.length ? { done: !0 } : { done: !1, value: e[n++] };
          },
          e: function (e) {
            throw e;
          },
          f: i,
        };
      }
      throw new TypeError(
        "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."
      );
    }
    var o,
      r,
      a = !0,
      s = !1;
    return {
      s: function () {
        o = e[Symbol.iterator]();
      },
      n: function () {
        var e = o.next();
        return (a = e.done), e;
      },
      e: function (e) {
        (s = !0), (r = e);
      },
      f: function () {
        try {
          a || null == o.return || o.return();
        } finally {
          if (s) throw r;
        }
      },
    };
  }
  var i = "autoComplete_list",
    o = "autoComplete_result",
    r = "autoComplete_highlighted",
    a = "autoComplete_selected",
    s = 13,
    l = 38,
    u = 40,
    c = function (e) {
      return "string" == typeof e ? document.querySelector(e) : e();
    },
    d = function (e) {
      var t = document.createElement(e.element);
      return (
        t.setAttribute("id", i),
        e.container && e.container(t),
        e.destination.insertAdjacentElement(e.position, t),
        t
      );
    },
    h = function (e) {
      return "<span class=".concat(r, ">").concat(e, "</span>");
    },
    f = function (e) {
      return (e.innerHTML = "");
    },
    v = function (e, t, n, i, o, r) {
      i({
        event: e,
        query: t instanceof HTMLInputElement ? t.value : t.innerHTML,
        matches: o.matches,
        results: o.list.map(function (e) {
          return e.value;
        }),
        selection: o.list.find(function (t) {
          return e.keyCode === s
            ? t.index === Number(r.getAttribute("data-id"))
            : "mousedown" === e.type
            ? t.index === Number(e.currentTarget.getAttribute("data-id"))
            : void 0;
        }),
      }),
        f(n);
    },
    m = function (e, t) {
      t = t || { bubbles: !1, cancelable: !1, detail: void 0 };
      var n = document.createEvent("CustomEvent");
      return n.initCustomEvent(e, t.bubbles, t.cancelable, t.detail), n;
    };
  m.prototype = window.Event.prototype;
  var p = {
    CustomEventWrapper:
      ("function" == typeof window.CustomEvent && window.CustomEvent) || m,
    initElementClosestPolyfill: function () {
      Element.prototype.matches ||
        (Element.prototype.matches =
          Element.prototype.msMatchesSelector ||
          Element.prototype.webkitMatchesSelector),
        Element.prototype.closest ||
          (Element.prototype.closest = function (e) {
            var t = this;
            do {
              if (t.matches(e)) return t;
              t = t.parentElement || t.parentNode;
            } while (null !== t && 1 === t.nodeType);
            return null;
          });
    },
  };
  return (function () {
    function t(e) {
      !(function (e, t) {
        if (!(e instanceof t))
          throw new TypeError("Cannot call a class as a function");
      })(this, t);
      var n = e.selector,
        i = void 0 === n ? "#autoComplete" : n,
        o = e.data,
        r = o.key,
        a = o.src,
        s = o.cache,
        l = void 0 === s || s,
        u = e.query,
        h = e.trigger,
        f = (h = void 0 === h ? {} : h).event,
        v = void 0 === f ? ["input"] : f,
        m = h.condition,
        p = void 0 !== m && m,
        y = e.searchEngine,
        g = void 0 === y ? "strict" : y,
        b = e.threshold,
        E = void 0 === b ? 0 : b,
        w = e.debounce,
        C = void 0 === w ? 0 : w,
        S = e.resultsList,
        L = (S = void 0 === S ? {} : S).render,
        k = void 0 !== L && L,
        x = S.container,
        A = void 0 !== x && x,
        T = S.destination,
        M = S.position,
        R = void 0 === M ? "afterend" : M,
        q = S.element,
        H = void 0 === q ? "ul" : q,
        I = S.navigation,
        j = void 0 !== I && I,
        P = e.sort,
        N = void 0 !== P && P,
        V = e.placeHolder,
        _ = e.maxResults,
        O = void 0 === _ ? 5 : _,
        D = e.resultItem,
        W = (D = void 0 === D ? {} : D).content,
        F = void 0 !== W && W,
        U = D.element,
        $ = void 0 === U ? "li" : U,
        z = e.noResults,
        B = e.highlight,
        G = void 0 !== B && B,
        J = e.onSelection,
        K = k
          ? d({ container: A, destination: T || c(i), position: R, element: H })
          : null;
      (this.selector = i),
        (this.data = {
          src: function () {
            return "function" == typeof a ? a() : a;
          },
          key: r,
          cache: l,
        }),
        (this.query = u),
        (this.trigger = { event: v, condition: p }),
        (this.searchEngine =
          "loose" === g ? "loose" : "function" == typeof g ? g : "strict"),
        (this.threshold = E),
        (this.debounce = C),
        (this.resultsList = { render: k, view: K, navigation: j }),
        (this.sort = N),
        (this.placeHolder = V),
        (this.maxResults = O),
        (this.resultItem = { content: F, element: $ }),
        (this.noResults = z),
        (this.highlight = G),
        (this.onSelection = J),
        this.init();
    }
    var i, r, m;
    return (
      (i = t),
      (r = [
        {
          key: "search",
          value: function (e, t) {
            var n = t.toLowerCase();
            if ("loose" === this.searchEngine) {
              e = e.replace(/ /g, "");
              for (var i = [], o = 0, r = 0; r < n.length; r++) {
                var a = t[r];
                o < e.length &&
                  n[r] === e[o] &&
                  ((a = this.highlight ? h(a) : a), o++),
                  i.push(a);
              }
              return o === e.length && i.join("");
            }
            if (n.includes(e))
              return (
                (e = new RegExp("".concat(e), "i").exec(t)),
                this.highlight ? t.replace(e, h(e)) : t
              );
          },
        },
        {
          key: "listMatchedResults",
          value: function (e) {
            var t = this;
            return new Promise(function (i) {
              var o = [];
              e.filter(function (e, i) {
                var r = function (n) {
                  var r = n ? e[n] : e;
                  if (r) {
                    var a =
                      "function" == typeof t.searchEngine
                        ? t.searchEngine(t.queryValue, r)
                        : t.search(t.queryValue, r);
                    a && n
                      ? o.push({ key: n, index: i, match: a, value: e })
                      : a && !n && o.push({ index: i, match: a, value: e });
                  }
                };
                if (t.data.key) {
                  var a,
                    s = n(t.data.key);
                  try {
                    for (s.s(); !(a = s.n()).done; ) {
                      r(a.value);
                    }
                  } catch (e) {
                    s.e(e);
                  } finally {
                    s.f();
                  }
                } else r();
              });
              var r = t.sort
                ? o.sort(t.sort).slice(0, t.maxResults)
                : o.slice(0, t.maxResults);
              return i({ matches: o.length, list: r });
            });
          },
        },
        {
          key: "ignite",
          value: function () {
            var e = this,
              t = c(this.selector);
            this.placeHolder && t.setAttribute("placeholder", this.placeHolder);
            var n = function (n) {
              var i =
                  t instanceof HTMLInputElement ||
                  t instanceof HTMLTextAreaElement
                    ? t.value.toLowerCase()
                    : t.innerHTML.toLowerCase(),
                r = (e.queryValue =
                  e.query && e.query.manipulate ? e.query.manipulate(i) : i),
                c = e.resultsList.render,
                d = e.trigger.condition
                  ? e.trigger.condition(r)
                  : r.length >= e.threshold && r.replace(/ /g, "").length,
                h = function (e, n) {
                  t.dispatchEvent(
                    new p.CustomEventWrapper("autoComplete", {
                      bubbles: !0,
                      detail: {
                        event: e,
                        input: i,
                        query: r,
                        matches: n ? n.matches : null,
                        results: n ? n.list : null,
                      },
                      cancelable: !0,
                    })
                  );
                };
              if (c) {
                var m = e.resultsList.view;
                f(m);
                d
                  ? e.listMatchedResults(e.dataStream, n).then(function (i) {
                      h(n, i),
                        e.resultsList.render &&
                          (0 === i.list.length && e.noResults
                            ? e.noResults()
                            : ((function (e, t, n) {
                                var i = document.createDocumentFragment();
                                t.forEach(function (e, r) {
                                  var a = document.createElement(n.element),
                                    s = t[r].index;
                                  a.setAttribute("data-id", s),
                                    a.setAttribute("class", o),
                                    n.content
                                      ? n.content(e, a)
                                      : (a.innerHTML = e.match || e),
                                    i.appendChild(a);
                                }),
                                  e.appendChild(i);
                              })(m, i.list, e.resultItem),
                              e.onSelection &&
                                (e.resultsList.navigation
                                  ? e.resultsList.navigation(
                                      n,
                                      t,
                                      m,
                                      e.onSelection,
                                      i
                                    )
                                  : (function (e, t, n, i) {
                                      var o,
                                        r = t.childNodes,
                                        c = r.length - 1,
                                        d = void 0,
                                        h = function (e) {
                                          d.classList.remove(a),
                                            (o =
                                              1 === e
                                                ? d.nextSibling
                                                : d.previousSibling);
                                        },
                                        f = function (e) {
                                          (d = e).classList.add(a);
                                        };
                                      (e.onkeydown = function (a) {
                                        if (
                                          (console.log(a.inputValue),
                                          r.length > 0)
                                        )
                                          switch (a.keyCode) {
                                            case l:
                                              a.preventDefault(),
                                                d
                                                  ? (h(0), f(o || r[c]))
                                                  : f(r[c]);
                                              break;
                                            case u:
                                              d
                                                ? (h(1), f(o || r[0]))
                                                : f(r[0]);
                                              break;
                                            case s:
                                              d && v(a, e, t, n, i, d);
                                          }
                                      }),
                                        r.forEach(function (o) {
                                          o.onmousedown = function (o) {
                                            return v(o, e, t, n, i);
                                          };
                                        });
                                    })(t, m, e.onSelection, i))));
                    })
                  : h(n);
              } else
                !c &&
                  d &&
                  e.listMatchedResults(e.dataStream, n).then(function (e) {
                    h(n, e);
                  });
            };
            this.trigger.event.forEach(function (i) {
              var o, r, a;
              t.addEventListener(
                i,
                ((o = function (t) {
                  return (function (t) {
                    Promise.resolve(
                      e.data.cache ? e.dataStream : e.data.src()
                    ).then(function (i) {
                      (e.dataStream = i), n(t);
                    });
                  })(t);
                }),
                (r = e.debounce),
                function () {
                  var e = this,
                    t = arguments;
                  clearTimeout(a),
                    (a = setTimeout(function () {
                      return o.apply(e, t);
                    }, r));
                })
              );
            });
          },
        },
        {
          key: "init",
          value: function () {
            var e = this;
            this.data.cache
              ? Promise.resolve(this.data.src()).then(function (t) {
                  (e.dataStream = t), e.ignite();
                })
              : this.ignite(),
              p.initElementClosestPolyfill();
          },
        },
      ]) && e(i.prototype, r),
      m && e(i, m),
      t
    );
  })();
});
